// --------------------- Global scripts ------------------------

let catalogData = [{
        id: 0,
        type: "bags",
        preview: {
            leftText: `Descoperă eleganța și funcționalitatea într-o gamă variată de genti din piele naturală, create cu grijă și atenție la detalii. Fie că ești în căutarea unei genți de mână spațioase pentru ziua de lucru sau a unei poșete chic, colecția noastră de genti îmbină designul clasic cu durabilitatea și rafinamentul pielii naturale.`,
            leftImg1: "../assets/images/png/bags/catalogInfoBags_img1.png",
            rightImg1: "../assets/images/png/bags/catalogInfoBags_img2.png",
            rightImg2: "../assets/images/png/bags/catalogInfoBags_img3.png",
            slider: [
                "../assets/images/png/bags/catalogInfoCaruselBags_img1.png",
                "../assets/images/png/bags/catalogInfoCaruselBags_img2.png",
                "../assets/images/png/bags/catalogInfoCaruselBags_img3.png"
            ]
        },
        products: [{
                id: 1001,
                image: "../assets/images/png/bags/Bags_img1.png",
                price: 800,
                title: "Geantă Tote Elegantă din Piele",
                text: "O geantă tote atemporală realizată din piele luxoasă, perfectă pentru orice ocazie."
            },
            {
                id: 1002,
                image: "../assets/images/png/bags/Bags_img2.png",
                price: 900,
                title: "Geantă Messenger Clasică din Piele",
                text: "O geantă messenger sofisticată confecționată din piele premium pentru un aspect elegant."
            },
            {
                id: 1003,
                image: "../assets/images/png/bags/Bags_img3.png",
                price: 1200,
                title: "Rucsac Vintage din Piele",
                text: "Un rucsac vintage inspirat din piele genuină, ideal pentru aventurieri."
            },
            {
                id: 1004,
                image: "../assets/images/png/bags/Bags_img4.png",
                price: 600,
                title: "Clutch Chic din Piele",
                text: "Un clutch elegant confecționat din piele maleabilă, perfect pentru serile în oraș."
            },
            {
                id: 1005,
                image: "../assets/images/png/bags/Bags_img5.png",
                price: 1000,
                title: "Geantă Crossbody Stilată din Piele",
                text: "O geantă crossbody stilată concepută pentru confort și modă, realizată din piele premium."
            },
            {
                id: 1006,
                image: "../assets/images/png/bags/Bags_img6.png",
                price: 1500,
                title: "Satchel Modern din Piele",
                text: "Un satchel modern realizat din piele de înaltă calitate, perfect pentru profesioniști."
            },
            {
                id: 1007,
                image: "../assets/images/png/bags/Bags_img7.png",
                price: 2000,
                title: "Duffle Bag Handcrafted din Piele",
                text: "O geantă duffle lucrată manual cu grijă din piele durabilă, ideală pentru călători."
            },
            {
                id: 1008,
                image: "../assets/images/png/bags/Bags_img8.png",
                price: 1300,
                title: "Geantă Hobo Luxoasă din Piele",
                text: "O geantă hobo luxoasă realizată din piele premium, oferind atât stil, cât și funcționalitate."
            },
            {
                id: 1009,
                image: "../assets/images/png/bags/Bags_img9.png",
                price: 1800,
                title: "Servietă Robustă din Piele",
                text: "O servietă robustă confecționată din piele genuină, perfectă pentru profesioniștii din domeniul afacerilor."
            },
            {
                id: 1010,
                image: "../assets/images/png/bags/Bags_img10.png",
                price: 400,
                title: "Portofel Compact din Piele",
                text: "Un portofel compact realizat din piele durabilă, conceput pentru a-ți ține esențialele organizate."
            },
            {
                id: 1011,
                image: "../assets/images/png/bags/Bags_img11.png",
                price: 950,
                title: "Geantă Tote Sleek din Piele",
                text: "O geantă tote sleek realizată din piele maleabilă, perfectă pentru utilizarea zilnică."
            },
            {
                id: 1012,
                image: "../assets/images/png/bags/Bags_img12.png",
                price: 1400,
                title: "Rucsac Fashionabil din Piele",
                text: "Un rucsac fashionabil realizat din piele premium, oferind atât stil, cât și utilitate."
            },
            {
                id: 1013,
                image: "../assets/images/png/bags/Bags_img13.png",
                price: 1100,
                title: "Geantă Shoulder Sophisticated din Piele",
                text: "O geantă de umăr sofisticată realizată din piele de înaltă calitate, perfectă pentru orice ocazie."
            },
            {
                id: 1014,
                image: "../assets/images/png/bags/Bags_img14.png",
                price: 750,
                title: "Poșetă Crossbody Versatilă din Piele",
                text: "O poșetă crossbody versatilă realizată din piele genuină, ideală pentru utilizarea zilnică."
            }
        ]
    },
    {
        id: 1,
        type: "belts",
        preview: {
            leftText: `Completează-ți ținuta cu stil și eleganță cu o curea de la Riri Leather. Fie că preferi un design clasic sau unul mai modern, curelele noastre sunt realizate cu măiestrie din piele naturală de cea mai înaltă calitate, oferind confort și durabilitate pe termen lung. Alege dintr-o varietate de stiluri și culori pentru a-ți exprima personalitatea și stilul propriu.`,
            leftImg1: "../assets/images/png/belts/catalogInfoBelts_img1.png",
            rightImg1: "../assets/images/png/belts/catalogInfoBelts_img2.png",
            rightImg2: "../assets/images/png/belts/catalogInfoBelts_img3.png",
            slider: [
                "../assets/images/png/belts/catalogInfoCaruselBelts_img1.png",
                "../assets/images/png/belts/catalogInfoCaruselBelts_img2.png",
                "../assets/images/png/belts/catalogInfoCaruselBelts_img3.png"
            ]
        },
        products: [{
                id: 2001,
                image: "../assets/images/png/belts/Belts_img1.png",
                price: 350,
                title: "Curea Clasică din Piele",
                text: "Curea clasică din piele de înaltă calitate."
            },
            {
                id: 2002,
                image: "../assets/images/png/belts/Belts_img2.png",
                price: 400,
                title: "Curea Elegantă cu Cataramă Rotundă",
                text: "Curea elegantă cu cataramă rotundă, potrivită pentru ocazii speciale."
            },
            {
                id: 2003,
                image: "../assets/images/png/belts/Belts_img3.png",
                price: 300,
                title: "Curea Casual cu Fibulă de Metal",
                text: "Curea casual cu fibulă de metal, potrivită pentru stilul de zi cu zi."
            },
            {
                id: 2004,
                image: "../assets/images/png/belts/Belts_img4.png",
                price: 450,
                title: "Curea Modernă din Piele",
                text: "Curea modernă din piele cu design minimalist."
            },
            {
                id: 2005,
                image: "../assets/images/png/belts/Belts_img5.png",
                price: 380,
                title: "Curea Lărgită cu Cataramă Detaliată",
                text: "Curea lărgită cu cataramă detaliată, adaugă un plus de stil oricărei ținute."
            },
            {
                id: 2006,
                image: "../assets/images/png/belts/Belts_img6.png",
                price: 280,
                title: "Curea Casual din Piele",
                text: "Curea casual din piele, confortabilă și ușor de asortat."
            },
            {
                id: 2007,
                image: "../assets/images/png/belts/Belts_img7.png",
                price: 550,
                title: "Curea de Designer din Piele Exotică",
                text: "Curea de designer din piele exotică, pentru un aspect unic."
            },
            {
                id: 2008,
                image: "../assets/images/png/belts/Belts_img8.png",
                price: 500,
                title: "Curea Sport cu Detalii Reflectante",
                text: "Curea sport cu detalii reflectante, perfectă pentru activități în aer liber."
            },
            {
                id: 2009,
                image: "../assets/images/png/belts/Belts_img9.png",
                price: 320,
                title: "Curea Casual din Piele",
                text: "Curea casual din piele, ușor de purtat și versatilă."
            },
            {
                id: 2010,
                image: "../assets/images/png/belts/Belts_img10.png",
                price: 420,
                title: "Curea Subțire cu Cataramă Rotundă",
                text: "Curea subțire cu cataramă rotundă, ideală pentru ținutele de vară."
            }
        ]
    },
    {
        id: 2,
        type: "wallets",
        preview: {
            leftText: `Păstrează-ți cardurile, bancnotele și monedele organizate într-un portmoneu elegant și practic de la Riri Leather. Fie că preferi un design minimalist sau unul mai sofisticat, portmoneele noastre sunt realizate cu atenție la detalii din piele naturală de cea mai bună calitate, garantându-ți nu doar un aspect elegant, ci și o funcționalitate impecabilă.`,
            leftImg1: "../assets/images/png/wallets/catalogInfoWallets_img1.png",
            rightImg1: "../assets/images/png/wallets/catalogInfoWallets_img2.png",
            rightImg2: "../assets/images/png/wallets/catalogInfoWallets_img3.png",
            slider: [
                "../assets/images/png/wallets/catalogCaruselWallets_img1.png",
                "../assets/images/png/wallets/catalogInfoCaruselWallets_img2.png",
                "../assets/images/png/wallets/catalogInfoCaruselWallets_img3.png"
            ]
        },
        products: [{
                id: 3001,
                image: "../assets/images/png/wallets/Wallets_img1.png",
                price: 500,
                title: "Portofel Clasic din Piele",
                text: "Portofel clasic realizat din piele de înaltă calitate."
            },
            {
                id: 3002,
                image: "../assets/images/png/wallets/Wallets_img2.png",
                price: 600,
                title: "Portofel Eleganta cu Fermoar Metalic",
                text: "Portofel elegant cu fermoar metalic, ideal pentru ocazii speciale."
            },
            {
                id: 3003,
                image: "../assets/images/png/wallets/Wallets_img3.png",
                price: 450,
                title: "Portofel Minimalist cu Buzunare Multiple",
                text: "Portofel minimalist cu multiple buzunare, perfect pentru organizarea cardurilor și bancnotelor."
            },
            {
                id: 3004,
                image: "../assets/images/png/wallets/Wallets_img4.png",
                price: 700,
                title: "Portofel Modern din Piele",
                text: "Portofel modern din piele, cu design simplu și elegant."
            },
            {
                id: 3005,
                image: "../assets/images/png/wallets/Wallets_img5.png",
                price: 550,
                title: "Portofel Clasic cu Fereastră pentru ID",
                text: "Portofel clasic cu fereastră specială pentru buletin sau card de identitate."
            },
            {
                id: 3006,
                image: "../assets/images/png/wallets/Wallets_img6.png",
                price: 400,
                title: "Portofel Compact din Piele",
                text: "Portofel compact din piele, perfect pentru cei care preferă să călătorească ușor."
            },
            {
                id: 3007,
                image: "../assets/images/png/wallets/Wallets_img7.png",
                price: 800,
                title: "Portofel de Lux din Piele Exotică",
                text: "Portofel de lux din piele exotică, pentru cei care apreciază exclusivitatea."
            },
            {
                id: 3008,
                image: "../assets/images/png/wallets/Wallets_img8.png",
                price: 750,
                title: "Portofel Sport cu Cureaua de Mână",
                text: "Portofel sport cu cureaua de mână, ideal pentru activități în aer liber."
            },
            {
                id: 3009,
                image: "../assets/images/png/wallets/Wallets_img9.png",
                price: 500,
                title: "Portofel Casual din Piele",
                text: "Portofel casual din piele, potrivit pentru uzul zilnic."
            },
            {
                id: 3010,
                image: "../assets/images/png/wallets/Wallets_img10.png",
                price: 650,
                title: "Portofel Eleganta cu Cataramă Rotundă",
                text: "Portofel elegant cu cataramă rotundă, adaugă un plus de stil oricărei ținute."
            },
            {
                id: 3011,
                image: "../assets/images/png/wallets/Wallets_img11.png",
                price: 550,
                title: "Portofel Clasic cu Curea de Mână",
                text: "Portofel clasic cu curea de mână, pentru o purtare comodă."
            },
            {
                id: 3012,
                image: "../assets/images/png/wallets/Wallets_img12.png",
                price: 900,
                title: "Portofel Eleganta cu Detalii Aurii",
                text: "Portofel elegant cu detalii aurii, potrivit pentru evenimentele speciale."
            },
            {
                id: 3013,
                image: "../assets/images/png/wallets/Wallets_img13.png",
                price: 600,
                title: "Portofel Minimalist cu Cusături Evidente",
                text: "Portofel minimalist cu cusături evidente, pentru un aspect modern."
            },
            {
                id: 3014,
                image: "../assets/images/png/wallets/Wallets_img14.png",
                price: 800,
                title: "Portofel de Lux cu Logo Metalic",
                text: "Portofel de lux cu logo metalic, o alegere elegantă pentru persoanele rafinate."
            }
        ]
    },
]

// 1 disclaimer per session control
if (!sessionStorage.getItem('sessionEnter')) {
    sessionStorage.setItem('sessionEnter', '1');
    const myPopup = new Popup({
        id: "disclaimerTekwill",
        title: "Disclaimer",
        content: `
        Acest website a fost realizat în cadrul competiției "Tekwill Junior Ambassadors" organizată de proiectul "Tekwill în Fiecare Școală" și nu reflectă neapărat opinia proiectului.
        `,
        showImmediately: true,
    });
}

pageLoader();

function pageLoader(time = 1000) {
    document.querySelector(".page-loader").classList.remove("page-loader_hidden");
    setTimeout(() => {
        document.querySelector(".page-loader").classList.add("page-loader_hidden");
    }, time);
}

// overlay of body for modals
let overlay;
if (document.querySelector(".page-overlay")) {
    overlay = document.querySelector(".page-overlay")
}

// header for mobile view
if (document.querySelector(".site-header")) {
    let menu = document.querySelector(".header-menu");
    let menuOpen = document.querySelector(".burger-menu");
    let menuClose = document.querySelector(".burger-close");


    menuOpen.addEventListener("click", () => {
        menu.classList.remove("header-menu_hidden");
        if (overlay) {
            overlay.classList.add("page-overlay_active");
        }
        document.body.classList.add("block-scroll");
    });
    menuClose.addEventListener("click", () => {
        menu.classList.add("header-menu_hidden");
        if (overlay) {
            overlay.classList.remove("page-overlay_active");
        }
        document.body.classList.remove("block-scroll");
    });
}

if (document.querySelector(".back-to-top")) {
    window.addEventListener('scroll', function () {
        let scrollPosition = window.scrollY;
        let toTop = document.querySelector(".back-to-top")
        if (scrollPosition > 200) {
            toTop.classList.remove("back-to-top__hidden");
        } else {
            toTop.classList.add("back-to-top__hidden");
        }
    });
}

window.addEventListener('pushstate', function (event) {
    // Log the state data to the console
    console.log(event.state);
});

// --------------------- Catalog scripts ------------------------
if (document.querySelector(".catalog-page")) {
    let activeCategoryId = 0;
    // get categories by url
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    if (urlParams.has('type_id')) {
        if (!isNaN(urlParams.get('type_id'))) {
            activeCategoryId = parseInt(urlParams.get('type_id'));
            // set current category active button
            let categories = document.getElementById("categories").querySelectorAll(".category");
            if (categories) {
                categories.forEach((elem) => {
                    elem.classList.remove("category_active");
                });
                categories[activeCategoryId].classList.add("category_active");
            }
            getCategory(activeCategoryId)
        }
    } else {
        getCategory();
    }
    if (document.getElementById("categories")) {
        // center slider of each category page
        let splide = new Splide('.splide', {
            type: 'loop',
            autoplay: true,
            interval: 3000,
            arrows: false
        });
        splide.mount();

        //category switch from page
        let categories = document.getElementById("categories").querySelectorAll(".category");
        if (categories) {
            categories.forEach((elem, id) => {
                elem.addEventListener("click", () => {
                    categories[activeCategoryId].classList.remove("category_active");
                    activeCategoryId = id;
                    pageLoader(1000);
                    elem.classList.add("category_active");
                    getCategory(elem.id.split("-")[1]);
                })
            });
        }
    }
}

function getCategory(categoryId = 0) {
    let categoryData = catalogData[categoryId];
    // console.log(categoryId);
    window.history.replaceState(null, null, `?type_id=${categoryId}`);
    // window.history.pushState(null, null, `?type_id=${categoryId}`);
    let previewLeftText = document.querySelector(".preview-left-text");
    let previewLeftImage = document.querySelector(".preview-left-image");
    let previewRightImage1 = document.querySelector(".preview-right-image1");
    let previewRightImage2 = document.querySelector(".preview-right-image2");
    // Splide set clones for blocks, so need to select only original blocks
    let previewSlides = document.querySelectorAll(".splide__slide:not(.splide__slide--clone)");
    let productsBlock = document.querySelector(".products-block");

    if (previewLeftText) {
        previewLeftText.textContent = categoryData.preview.leftText;
    }
    if (previewLeftImage) {
        previewLeftImage.setAttribute("src", categoryData.preview.leftImg1);
    }
    if (previewRightImage1) {
        previewRightImage1.setAttribute("src", categoryData.preview.rightImg1);
    }
    if (previewRightImage2) {
        previewRightImage2.setAttribute("src", categoryData.preview.rightImg2);
    }
    if (previewSlides) {
        previewSlides.forEach((elem, id) => {
            image = elem.querySelector(".inner-slider_image");
            if (image) {
                image.setAttribute("src", categoryData.preview.slider[id]);
            }
        });
    }

    if (productsBlock) {
        productsBlock.innerHTML = '';
        categoryData.products.forEach((elem) => {
            let product = `<div class="product" id="product-${elem.id}">
                <figure class="image">
                  <img
                    loading = "lazy"
                    src="${elem.image}"
                    alt="${categoryData.type}-${elem.id}"
                  />
                </figure>
                <div class="info">
                  <p class="price">${elem.price} MDL</p>
                  <p class="title">${elem.title}</p>
                  <p class="text">
                    ${elem.text}
                  </p>
                  <a href="../contact.html" class="bag-icon"></a>
                </div>
              </div>`;
            productsBlock.innerHTML += product;
        });
    }
}

// --------------------- Contact scripts ------------------------
if (document.querySelector(".contact-page")) {
    toastr.options = {
        "closeButton": true,
        "debug": false,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-top-right",
        "preventDuplicates": false,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    }
    if (document.getElementById("my-form")) {
        let form = document.getElementById("my-form");

        form.addEventListener("submit", (event) => {
            event.preventDefault();
            let data = new FormData(event.target);
            if (data) {
                if (data.get("email").trim().includes("@") && data.get("phone").trim()) {
                    let xhr = new XMLHttpRequest();
                    xhr.open(form.method, form.action, true);
                    xhr.setRequestHeader('Accept', 'application/json');

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 200) {
                                toastr["success"]("Forma a fost trimisa cu succes!", "Success");
                                form.reset();
                            } else {
                                let responseJSON = JSON.parse(xhr.responseText);
                                if (responseJSON.errors) {
                                    toastr["error"](`Eroare la trimiterea formei: ${error.message}`, "Error");
                                } else {
                                    toastr["error"]("A aparut o problema necunoscuta la trimiterea formei", "Error");
                                }
                            }
                        }
                    };

                    xhr.send(data);
                } else {
                    toastr["error"]("Introduceti datele necesare", "Error");
                }
            }
        });
    }
}